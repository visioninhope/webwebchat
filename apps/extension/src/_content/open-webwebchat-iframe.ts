// create an iframe and append it to the body
const iframeAddShowHide = () => {
    const iframeElem = document.getElementById("webwebchat-iframe");
    if (iframeElem) {
        const backdropElem = document.getElementById("webwebchat-backdrop");
        if (iframeElem.style.display === "none") {
            document.body.style.overflow = "hidden";
            iframeElem.style.display = "block";
            backdropElem!.style.display = "block";
        } else {
            document.body.style.overflow = "auto";
            iframeElem.style.display = "none";
            backdropElem!.style.display = "none";
        }
    } else {
        const backdrop = document.createElement("div");
        backdrop.style.position = "fixed";
        backdrop.style.top = "0";
        backdrop.style.left = "0";
        backdrop.style.right = "0";
        backdrop.style.bottom = "0";
        backdrop.style.zIndex = "2147483645";
        backdrop.style.backgroundColor = "rgba(0,0,0,0.5)";
        backdrop.id = "webwebchat-backdrop";
        backdrop.onclick = () => {
            iframeAddShowHide();
        };
        // put a loading text in the middle
        backdrop.innerHTML = '<div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: white;">webwebchat loading...</div>';

        document.body.appendChild(backdrop);

        const iframe = document.createElement("iframe");
        iframe.src = chrome.runtime.getURL('index.html');
        // calc 100% - 2em;
        iframe.style.width = "calc(100% - 2em)";
        iframe.style.height = "100%";
        iframe.style.position = "fixed";
        iframe.style.top = "0";
        iframe.style.left = "2em";
        iframe.style.right = "0";
        iframe.style.bottom = "0";
        iframe.style.zIndex = "2147483646";
        iframe.style.border = "none";
        iframe.id = "webwebchat-iframe";
        iframe.style.display = "block";
        document.body.style.overflow = "hidden";
        document.body.appendChild(iframe);
    }
};

const addBtn = () => {
    if (document.getElementById("webwebchat-btn")) {
        return;
    }
    const btn = document.createElement("button");
    btn.innerHTML = `
    <svg fill="#000000" width="2em" height="2em" viewBox="0 -3.5 100 100" xmlns="http://www.w3.org/2000/svg">
        <path id="robot" d="M1142.745,975.8c-.226-1-1.416-1.033-1.7-1.974a51.252,51.252,0,0,1-1.127-12.424c-.523-4.089-1.44-7.785-1.978-11.857-2.785.32-5.336.876-7.056,2.257a30.453,30.453,0,0,0-1.415,11.295c.574,2.345,1.024,4.81,1.415,7.34.712,1.975,1.6,5.241-1.415,5.363-2.2-.436-2.106-3.166-2.54-5.363-.624-.035-.119-1.2-.283-1.694-.625-.035-.121-1.2-.282-1.695-.559-.668-.321-2.125-.848-2.823a41.643,41.643,0,0,1,1.694-13.553,10.935,10.935,0,0,1,6.775-4.233,6.6,6.6,0,0,1,3.109.563c.4-1.6-1.139-3.519-.85-5.927.465-1.046,2-1.01,2.541-1.98.4.028.8.049.85-.28,7.449-.175,13.027-2.219,20.044-2.823a64.375,64.375,0,0,0,7.908.284c-.012-1.779-.559-3.023-.567-4.8h-14.116a6.813,6.813,0,0,1-2.824-.848c-.878.735-2.1.01-2.822-.282-.859-1.861-.229-4.945,0-7.341v-9.316c.526-3.71.015-8.454,1.409-11.3,2.786-.791,6.432-.721,9.035-1.692.688-.348-.886-.783-1.129-1.13a2.622,2.622,0,0,1-.849-1.976c.2-2.158,2.791-1.919,3.389-3.669-.79-.53-2.407-.227-2.822-1.13-1.083-.144-2.193-.256-2.26-1.413-.265-2.053,1.355-2.219,2.822-2.541-1.413-3.481,2.426-5.147,5.649-3.952.541,1.315.377,3.553-.568,4.234-.992.8-2.3,1.273-3.1,2.258.317.531,1.093.6,1.411,1.13.187.011.393,0,.6,0,.671-.024,1.345-.049,1.376.569.072,2.051-1.467,2.489-1.976,3.952.659,1.038,2.4.984,1.976,3.106,10.8-.774,21.4-1.751,33.035-1.693a5.26,5.26,0,0,0,2.258.281c1.858,1.152,4.865,1.158,5.928,3.109.148,2.307-.814,3.513-1.13,5.362v21.176c-.512.334-.22,1.472-.566,1.976-.091.662-.872.632-1.129,1.129-2.018.415-2.43-.772-3.387-1.412-.244.4-.946.343-1.649.285a4.506,4.506,0,0,0-1.176,0,2.821,2.821,0,0,0-1.412.14,2.813,2.813,0,0,1-1.41.141c-1.691.287-3.676.279-5.364.565-.189,1.973.252,3.324.282,5.083,2.476.005,4.742-.155,7.047-.314a82.313,82.313,0,0,1,9.894-.252c2.65.738,6.216.562,8.752,1.411.314,1.1.14,2.684.847,3.388-.533,1.445.3,3.292,0,5.366a15.185,15.185,0,0,0,2.258-.283c3.345-1.012,7.768-.13,9.316,2.823.258.494.1,1.409.567,1.695.033,1.941-.152,4.1.282,5.646v9.883a21.1,21.1,0,0,1-.282,4.515c.153,1.753-.547,2.657-2.257,2.543-2.074-.063-1.417-3.495-1.13-5.083V949.827c-.743-1.841-3.393-1.771-6.043-1.7-.828.022-1.657.043-2.426.007v22.022c-.044,2.4.292,5.189-1.415,5.931-1.606-.09-1.572-1.814-1.976-3.107v-4.8c-.8-8.235.232-18.3-.563-26.538-2.623-.485-5.749-.464-7.906-1.413-10.109-.384-18.9-.031-28.8.282-5.007.734-10.874.611-15.531,1.7-4.808.836-8.574,2.718-13.27,3.67a128.433,128.433,0,0,1,1.976,21.74,14.185,14.185,0,0,0,.849,3.106v4.517c-.122,1.292-.618,2.209-1.979,2.26h-.06A1.719,1.719,0,0,1,1142.745,975.8Zm-3.389-32.751h.567v-.562h-.567Zm41.786-11.291c.8,1.462-.539,5.055,2.257,4.518a22.662,22.662,0,0,1-.281-4.8h-3.669c-.017.759.289.568.717.376a1.586,1.586,0,0,1,.632-.171A.777.777,0,0,1,1181.142,931.757Zm-28.233-26.541a28.252,28.252,0,0,0,.282,5.648c-.143,3.154.154,5.868.283,8.752v6.775c.081.495-.792,1.409,0,1.694.855-1.121,3.277-.673,4.8-1.129,4.006-.118,7.778,0,11.551.117,2.89.091,5.78.181,8.776.166.13-.4.716-.343,1.3-.286a3.145,3.145,0,0,0,.956,0h2.54a12.359,12.359,0,0,0,2.245-.163,10.9,10.9,0,0,1,2.84-.119,57.144,57.144,0,0,1,9.6-.849c-.067-7.052-.988-15.592.563-21.74-2.182-1.038-5.491-.944-8.8-.85-1.627.047-3.255.093-4.748,0-.364.014-.392.361-.848.282-5.221.238-10.549.368-16.095.283C1162.68,903.88,1158.407,905.161,1152.909,905.216Zm8.188,68.891a32.544,32.544,0,0,1-4.518-.846c.744-.665,2.391-.433,3.388-.848h3.388c1.772-.2,3.266-.687,5.081-.847,1.311-.026,3.614-1.374,4.519,0,.157,2.7-3.263,1.816-5.081,2.541Zm29.08-4.234c-.329-2.894,2.756-4.855,3.951-2.26q.192,2.727-1.693,3.389a2.954,2.954,0,0,1-.4.029A2.246,2.246,0,0,1,1190.177,969.873Zm-36.419-1.412c-.037-1.352.937-1.7,2.259-1.694a4.109,4.109,0,0,0,1.691-.142,4.1,4.1,0,0,1,1.693-.141,66.986,66.986,0,0,0,6.778-.565c2.573.033,4.527-.552,7.057-.563a11.739,11.739,0,0,1,3.39-.282c.509-.716,2.2-.242,2.823-.849,1.386-.163,2.082.366,2.259,1.413-.093,1.6-1.814,1.573-3.107,1.975-.506.343-1.642.051-1.975.564a3.1,3.1,0,0,1-.958,0c-.585-.056-1.169-.112-1.3.286a59.9,59.9,0,0,0-9.036.847h-6.213c-.853,0-1.773.086-2.622.086C1155.332,969.394,1154.3,969.232,1153.758,968.461Zm-2.543-10.166c-.539-1.211.323-3.177,0-5.081.383-.086.234-.707.284-1.129a5.387,5.387,0,0,0,1.125-1.976,29.537,29.537,0,0,1,8.754-5.082h4.8c3.252,1.651,4.409,6.868,3.387,11.857a87.753,87.753,0,0,0-11.291,1.695,17.419,17.419,0,0,0-3.215.023c-.639.046-1.253.091-1.818.091A4.085,4.085,0,0,1,1151.214,958.3Zm3.106-6.211a8.163,8.163,0,0,0-.562,3.67,22.124,22.124,0,0,0,6.774-.564c.615-.19-.535-.939-.849-1.13-.237-.61-.729-.961-.564-1.975,1.53-.94,2.6.7,3.955.846.221.625.986.707,1.411,1.129.178.688.513.533.984.379a1.754,1.754,0,0,1,.991-.1c.213-2.751-.194-4.885-1.411-6.212h-4.8C1158.208,949.384,1155.865,950.339,1154.32,952.085Zm-21.46,4.518c-.823-1.687.152-4.886,2.26-3.672.571,1.3.707,2.71-.282,3.672-.661.039-.92.186-1.254.186A1.8,1.8,0,0,1,1132.861,956.6Zm83.573-3.389c-.676-2.436,1.282-3.523,3.106-2.542.473.472.225,1.66.283,2.542a11.824,11.824,0,0,1-1.692,1.129C1217.373,954.159,1217.057,953.534,1216.434,953.214Zm-34.444.566c.061.015-.527-.259-.563-.283-.949-.625-.939-1.663-1.414-2.826a4.322,4.322,0,0,1,6.776-3.1,5.368,5.368,0,0,1,.849,3.1c-.268,1.954-2.567,3.26-4.549,3.26A3.836,3.836,0,0,1,1181.99,953.78Zm1.409-4.52v.849c.46.462,1.777.339,1.7-.565,0-.418-.393-.58-.806-.58A1.323,1.323,0,0,0,1183.4,949.261Zm7.625,3.954c-1.057-1.124-.955-3.544-.562-5.365,1.787-2.308,6.687-1.361,7.9.848a4.871,4.871,0,0,1-2.261,5.083c-.547.007-1.1.021-1.641.021A7.086,7.086,0,0,1,1191.024,953.214Zm2.26-3.1c-.232,1.021,2.132.68,1.977,0a1.771,1.771,0,0,0-1.977,0Zm7.339.563c-.314-1.534-.312-2.962.566-3.952,1.645-1.228,4.49-.139,5.366,1.13a2.539,2.539,0,0,1-2.739,4C1202.453,951.848,1201.1,951.488,1200.623,950.672Zm3.672-.845c.193-.76-.583-.545-.848-.847C1203.278,949.712,1203.56,950,1204.3,949.827Zm-36.7-24.846a6.956,6.956,0,0,1-.567-3.67,4.31,4.31,0,0,1,1.695-1.976c.382-.747,1.656-.6,2.259-1.129.829-.022,1.592.014,2.308.049,1.79.089,3.28.178,4.749-.614a8.445,8.445,0,0,0,3.412.171,8.213,8.213,0,0,1,3.082.111c1.531.908,1.459,4.663.282,5.93-1.724,1.45-4.919,1.431-8.116,1.412-.59,0-1.182-.007-1.763,0a25.925,25.925,0,0,1-4.323.54A4.746,4.746,0,0,1,1167.592,924.98Zm1.974-2.258c.771.625,2.268.175,2.827-.283v-1.977C1170.96,920.725,1169.668,921.129,1169.565,922.722Zm10.447-.283a3.634,3.634,0,0,0,3.106-.283v-1.975h-3.106Zm-5.081-1.977c-.137.891.508,1,.28,1.977h1.7v-2.258c-.139,0-.283,0-.427-.006s-.269-.007-.4-.007A1.587,1.587,0,0,0,1174.931,920.462Zm-12.422-3.388a8.192,8.192,0,0,1-3.39-1.41.773.773,0,0,0-.562-.848c-.027-.446.132-1.076-.283-1.128-.046-1.74.608-2.78.563-4.52a.773.773,0,0,0,.563-.846,8.467,8.467,0,0,1,2.541-1.412c2.553-.487,5.118.606,5.932,2.258.2,3.125-.418,5.417-1.695,7.06a8.424,8.424,0,0,1-3.428.85Q1162.632,917.078,1162.509,917.074Zm-.283-6.21c-.07,1.343-.877,1.945-1.129,3.106a4.669,4.669,0,0,0,3.668.565c.841-.872.6-2.967.283-4.238q-.348-.032-.664-.032A3.482,3.482,0,0,0,1162.226,910.864Zm23.152,4.235c-.976-1.191-1.029-3.3-1.13-5.364.519-3.238,3.961-5.293,7.621-3.671.292.742,1.122.95,1.414,1.693-.049.33.06.5.28.565.25,4.122-2.157,7.285-5.663,7.285A6.9,6.9,0,0,1,1185.378,915.1Zm1.41-1.977a2.851,2.851,0,0,0,3.955-2.54c-.361-.858-.776-1.2-1.2-1.2C1188.4,909.387,1187.2,911.826,1186.789,913.122Z" transform="translate(-1125.5 -884.504)"/>
    </svg>`;
    // btn.innerHTML = `
    // <svg xmlns="http://www.w3.org/2000/svg"
    //     height="2em"
    //     width="2em"
    //      viewBox="0 0 512 512">
    //      <path d="M256 448c141.4 0 256-93.1 256-208S397.4 32 256 32S0 125.1 0 240c0 45.1 17.7 86.8 47.7 120.9c-1.9 24.5-11.4 46.3-21.4 62.9c-5.5 9.2-11.1 16.6-15.2 21.6c-2.1 2.5-3.7 4.4-4.9 5.7c-.6 .6-1 1.1-1.3 1.4l-.3 .3 0 0 0 0 0 0 0 0c-4.6 4.6-5.9 11.4-3.4 17.4c2.5 6 8.3 9.9 14.8 9.9c28.7 0 57.6-8.9 81.6-19.3c22.9-10 42.4-21.9 54.3-30.6c31.8 11.5 67 17.9 104.1 17.9zM128 208a32 32 0 1 1 0 64 32 32 0 1 1 0-64zm128 0a32 32 0 1 1 0 64 32 32 0 1 1 0-64zm96 32a32 32 0 1 1 64 0 32 32 0 1 1 -64 0z"/>
    // </svg>`;
    // btn.innerHTML = `
    // <svg
    //     xmlns="http://www.w3.org/2000/svg"
    //     width="2em"
    //     height="2em"
    //     viewBox="0 0 512 512"
    // >
    // <path d="M0 256a256 256 0 1 1 512 0A256 256 0 1 1 0 256zM312.6 63.7c-6.2-6.2-16.4-6.2-22.6 0L256 97.6 222.1 63.7c-6.2-6.2-16.4-6.2-22.6 0s-6.2 16.4 0 22.6l33.9 33.9-45.3 45.3-56.6-56.6c-6.2-6.2-16.4-6.2-22.6 0s-6.2 16.4 0 22.6l56.6 56.6-45.3 45.3L86.3 199.4c-6.2-6.2-16.4-6.2-22.6 0s-6.2 16.4 0 22.6L97.6 256 63.7 289.9c-6.2 6.2-6.2 16.4 0 22.6s16.4 6.2 22.6 0l33.9-33.9 45.3 45.3-56.6 56.6c-6.2 6.2-6.2 16.4 0 22.6s16.4 6.2 22.6 0l56.6-56.6 45.3 45.3-33.9 33.9c-6.2 6.2-6.2 16.4 0 22.6s16.4 6.2 22.6 0L256 414.4l33.9 33.9c6.2 6.2 16.4 6.2 22.6 0s6.2-16.4 0-22.6l-33.9-33.9 45.3-45.3 56.6 56.6c6.2 6.2 16.4 6.2 22.6 0s6.2-16.4 0-22.6l-56.6-56.6 45.3-45.3 33.9 33.9c6.2 6.2 16.4 6.2 22.6 0s6.2-16.4 0-22.6L414.4 256l33.9-33.9c6.2-6.2 6.2-16.4 0-22.6s-16.4-6.2-22.6 0l-33.9 33.9-45.3-45.3 56.6-56.6c6.2-6.2 6.2-16.4 0-22.6s-16.4-6.2-22.6 0l-56.6 56.6-45.3-45.3 33.9-33.9c6.2-6.2 6.2-16.4 0-22.6zM142.9 256l45.3-45.3L233.4 256l-45.3 45.3L142.9 256zm67.9 67.9L256 278.6l45.3 45.3L256 369.1l-45.3-45.3zM278.6 256l45.3-45.3L369.1 256l-45.3 45.3L278.6 256zm22.6-67.9L256 233.4l-45.3-45.3L256 142.9l45.3 45.3z"/>
    // </svg>`;
    btn.style.position = "fixed";
    btn.style.top = "50%";
    btn.style.padding = "0";
    btn.style.left = "0";
    btn.style.backgroundColor = "white";
    btn.style.color = "black";
    btn.style.cursor = "pointer";
    btn.style.zIndex = "2147483647";
    btn.style.border = "none";
    btn.style.borderRadius = "0.4em";
    btn.setAttribute("aria-label", "Open webwebchat");
    btn.setAttribute("title", "Open webwebchat");
    btn.id = "webwebchat-btn";
    // make btn smaller
    btn.style.width = "2em";
    btn.style.height = "2em";
    btn.onclick = () => {
        iframeAddShowHide();
    };
    document.body.appendChild(btn);
};

addBtn();